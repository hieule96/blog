{{ $css := resources.Get "css/heavenly.css" }}
{{ if $css }}
<link rel="stylesheet" href="{{ $css.Permalink }}">
{{ end }}

{{ $js := resources.Get "js/wave.js" }}
{{ if $js }}
<script src="{{ $js.Permalink }}" defer></script>
{{ end }}

<!-- Mermaid.js for diagram rendering -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize mermaid
        mermaid.initialize({
            startOnLoad: false,
            theme: document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default',
            securityLevel: 'loose'
        });

        // Find all mermaid code blocks and render them
        document.querySelectorAll('pre code.language-mermaid').forEach(function (block) {
            const pre = block.parentElement;
            const code = block.textContent;

            // Create a container for the diagram
            const container = document.createElement('div');
            container.className = 'mermaid';
            container.textContent = code;

            // Replace the pre block with the mermaid container
            pre.parentNode.replaceChild(container, pre);
        });

        // Also handle already-wrapped mermaid divs
        mermaid.run();
    });
</script>
<style>
    .mermaid {
        text-align: center;
        margin: 1.5rem 0;
        background: var(--code-bg, #f5f5f5);
        padding: 1rem;
        border-radius: 8px;
    }

    [data-theme="dark"] .mermaid {
        background: #1e293b;
    }
</style>